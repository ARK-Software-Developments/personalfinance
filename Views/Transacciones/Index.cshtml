@using PersonalFinance.Models.Transacciones
@using System.Globalization
@{
    ViewData["Title"] = ViewBag.Title;
    ViewBag.Ruta = $"{ViewBag.Modulo} > {ViewBag.Title}";
    List<Transaccion> transacciones = ViewBag.Transacciones;
}

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="~/css/personalfinance.styles.css">

<script>
     $(function () {
        $('[data-bs-toggle="tooltip"]').tooltip();
    });

</script>

<div class="text-center">
    <h1 class="display-5">@ViewBag.Message</h1>
    <p>Listado de @ViewBag.Modulo.</p>
</div>

<div class="tab-content">
    <table class="table myaccordion table-hover" id="accordion">
        <thead>
            <tr>
                <th scope="col">Identificador interno</th>
                <th scope="col">Código Trans.</th>
                <th scope="col">Nro Orden / Compra</th>
                <th scope="col">Entidad Asociada</th>
                <th scope="col">Fecha Oper.</th>
                <th scope="col">Resumen</th>
                <th scope="col">Observaciones</th>
                <th scope="col">Tarjeta</th>
                <th scope="col">Consumo</th>
                <th>
                    &nbsp;
                    <form method="post" asp-controller="Pedidos">
                        <button type="submit" class="btn btn-primary" asp-controller="Transacciones" asp-action="TransaccionFormAdd" name="action" value="openFormAdd">Add new @ViewBag.Modulo</button>
                    </form>
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var entidad in @transacciones)
            {
                var titleTarjeta = $"Entidad: {entidad.Tarjeta.Entidad.Nombre}\n{entidad.Tarjeta.Nombre}\nCierre: {entidad.Tarjeta.FechaCierre.ToString("dd/MM/yyy", new CultureInfo("es-ES"))}\nVencimmiento: {entidad.Tarjeta.FechaVencimiento.ToString("dd/MM/yyy", new CultureInfo("es-ES"))}";

                var imgTarjeta = "{0}.png";
                var ico = string.Empty;
                switch (entidad.Tarjeta.Id)
                {
                    case 1:
                    case 3:
                    case 5:
                        ico = "visa";
                        break;

                    case 2:
                        ico = "amex";
                        break;                    

                    case 4:
                    case 6:
                        ico = "mc";
                        break;
                }

                var imgEntidad = $"{entidad.Tarjeta.Entidad.Tipo.ToLower()}.png";

                <tr>
                    <th scope="row" id="Id">@entidad.Id</th>
                    <td scope="row" id="CodigoTransaccion">@entidad.CodigoTransaccion</td>
                    <td scope="row" id="OrdenCompra">@entidad.OrdenCompra</td>
                    <td scope="row" id="EntidadAsociada" align="center">@entidad.EntidadAsociada</td>
                    <td scope="row" id="FechaTransaccion" align="center">@entidad.FechaTransaccion.ToString("dd/MM/yyy", new CultureInfo("es-ES"))</td>
                    <td scope="row" id="Resumen">@entidad.Resumen</td>
                    <td scope="row" id="Observaciones">@entidad.Observaciones</td>
                    <td scope="row" id="Tarjeta" title="@titleTarjeta">
                        @entidad.Tarjeta.Nombre
                        &nbsp;&nbsp;<img src="~/images/info.png" style="height: 25px; width: 25px; vertical-align: middle; align-content: center;" />
                        &nbsp;&nbsp;<img src="~/images/@imgTarjeta.Replace("{0}", ico)" style="height: 25px; width: 35px; vertical-align: middle; align-content: center;" />
                        &nbsp;&nbsp;<img src="~/images/@imgEntidad" style="height: 25px; width: 35px; vertical-align: middle; align-content: center;" />
                    </td>
                    <td scope="row" id="Observaciones" align="center">@entidad.TarjetaConsumoId</td>
                    <td>
                        <form method="post" asp-controller="@ViewBag.Modulo" asp-route-id="@entidad.Id">
                            <input type="text" name="Id" value="@entidad.Id" hidden="hidden" />
                            <button type="submit" class="btn btn-secondary" asp-controller="@ViewBag.Modulo" asp-action="TransaccionFormEdit" name="action" value="openFormEdit">Edit Entitty</button>
                            &nbsp;|&nbsp;
                            <button type="submit" class="btn btn-secondary" asp-controller="@ViewBag.Modulo" asp-action="TransaccionFormEdit" name="action" value="openFormView">View Entitty</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<p></p>
<p>>>>>>&nbsp;&nbsp;@ViewBag.Ruta</p>
<a href="/Tarjetas" class="btn btn-secondary">Volver</a>

<script src="~/js/jquery.min.js"></script>
<script src="~/js/popper.js"></script>
<script src="~/js/bootstrap.min.js"></script>
<script src="~/js/main.js"></script>